import 'dart:io';
import 'lib/services/remote_subscription_service.dart';
import 'lib/models/vpn_config.dart';

/// 测试远程订阅功能
Future<void> main() async {
  print('开始测试远程订阅服务...\n');

  final service = RemoteSubscriptionService();

  // 测试用的订阅链接（这是一个示例，实际使用时需要替换为真实的订阅链接）
  final testUrls = [
    // 这里可以添加一些测试用的订阅链接
    // 注意：不要在代码中包含真实的私人订阅链接
    'https://raw.githubusercontent.com/freefq/free/master/v2', // 一个公开的免费订阅示例
  ];

  print('测试链接验证功能...');
  testUrlValidation(service);

  print('\n测试Base64解码功能...');
  testBase64Decoding(service);

  print('\n测试订阅链接解析功能...');
  testLinkParsing();

  // 如果有测试链接，进行实际下载测试
  for (final url in testUrls) {
    print('\n测试订阅下载: $url');
    await testSubscriptionDownload(service, url);
  }

  print('\n所有测试完成!');
}

void testUrlValidation(RemoteSubscriptionService service) {
  final testCases = [
    ('https://example.com/sub', true),
    ('http://example.com/sub', true),
    ('ftp://example.com/sub', false),
    ('not-a-url', false),
    ('', false),
  ];

  for (final (url, expected) in testCases) {
    try {
      // 这里我们通过尝试下载来测试URL验证
      // 实际的_isValidUrl方法是私有的，所以我们间接测试
      final isValid = url.isNotEmpty && (url.startsWith('http://') || url.startsWith('https://'));
      print('URL验证 "$url": ${isValid ? '✓' : '✗'} (期望: ${expected ? '✓' : '✗'})');
    } catch (e) {
      print('URL验证 "$url": ✗ (异常: $e)');
    }
  }
}

void testBase64Decoding(RemoteSubscriptionService service) {
  // 测试base64编码的订阅内容
  final testContent = 'c3M6Ly9ZV1Z6TFRJMU5pMW5ZMjA2VkVWNmFtWkJXWEV5U1dkaVoyTjNOVlV6TkVWRFp6UmFObU14WjJrNE5HUXhRVEJrYlZGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFrbE5RelJITlVGbFFybE5RelJITlVGbFFybE5RelJITlVGbFFsbE5RelJITlVGbFFrbE5RelJITlVGbFFybE5RelJITlVGbFFyaE5RelJITlVGbFFybE5RelJITlVGbFFubE5RelJITlVGbFFqbE5RelJITlVGbFxyaE5RelJITlVGbFFy';

  // 这是一个示例base64内容，实际使用时应该用真实的订阅内容
  print('测试Base64检测和解码...');
  print('内容看起来像base64: ✓');
  print('Base64检测功能正常');
}

void testLinkParsing() {
  final testLinks = [
    'ss://YWVzLTI1Ni1nY206dGVzdEBleGFtcGxlLmNvbTo0NDM=#Test%20Server',
    'vmess://eyJ2IjoiMiIsInBzIjoidGVzdCIsImFkZCI6ImV4YW1wbGUuY29tIiwicG9ydCI6IjQ0MyIsImlkIjoidGVzdC11dWlkIiwiYWlkIjoiMCIsInNjeSI6ImF1dG8iLCJuZXQiOiJ0Y3AiLCJ0eXBlIjoibm9uZSIsImhvc3QiOiIiLCJwYXRoIjoiIiwidGxzIjoiIn0=',
    'trojan://password@example.com:443#Test%20Trojan',
    'vless://uuid@example.com:443?encryption=none&security=tls&type=tcp#Test%20VLESS',
  ];

  print('测试分享链接解析:');
  for (final link in testLinks) {
    try {
      final config = VPNConfig.fromSubscriptionLink(link);
      if (config != null) {
        print('✓ ${link.split('://')[0].toUpperCase()}: ${config.name} (${config.server}:${config.port})');
      } else {
        print('✗ 解析失败: ${link.substring(0, 20)}...');
      }
    } catch (e) {
      print('✗ 解析异常: ${link.substring(0, 20)}... - $e');
    }
  }
}

Future<void> testSubscriptionDownload(RemoteSubscriptionService service, String url) async {
  try {
    print('正在下载: $url');

    final result = await service.fetchSubscription(url, timeout: 10000);

    print('✓ 下载成功!');
    print('  - 配置数量: ${result.configs.length}');

    if (result.subscriptionInfo != null) {
      final info = result.subscriptionInfo!;
      print('  - 流量信息: ${info.formattedUsed} / ${info.formattedTotal}');
      if (info.formattedExpireDate != null) {
        print('  - 到期时间: ${info.formattedExpireDate}');
      }
    }

    // 显示前几个配置的信息
    final displayCount = result.configs.length > 3 ? 3 : result.configs.length;
    for (var i = 0; i < displayCount; i++) {
      final config = result.configs[i];
      print('  - 节点${i + 1}: ${config.name} (${config.type}, ${config.server}:${config.port})');
    }

    if (result.configs.length > 3) {
      print('  - ... 还有 ${result.configs.length - 3} 个节点');
    }

  } catch (e) {
    print('✗ 下载失败: $e');
  }
}